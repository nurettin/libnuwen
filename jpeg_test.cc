// Copyright Stephan T. Lavavej, http://nuwen.net .
// Distributed under the Boost Software License, Version 1.0.
// See accompanying file LICENSE_1_0.txt or copy at
// http://boost.org/LICENSE_1_0.txt .

#include "jpeg.hh"
#include "test.hh"
#include "typedef.hh"
#include "vector.hh"

#include "external_begin.hh"
    #include <boost/tuple/tuple.hpp>
#include "external_end.hh"

using namespace boost;
using namespace nuwen;

bool test() {
    const vuc_t image_jpeg = vuc_from_hex(
        "FFD8FFE000104A46494600010200006400640000FFEC00114475636B7900010004000000500000FFEE00264164"
        "6F62650064C0000000010300150403060A0D000001C7000002110000026A000002C4FFDB008400020202020202"
        "0202020203020202030403020203040504040404040506050505050505060607070807070609090A0A09090C0C"
        "0C0C0C0C0C0C0C0C0C0C0C0C0C01030303050405090606090D0B090B0D0F0E0E0E0E0F0F0C0C0C0C0C0F0F0C0C"
        "0C0C0C0C0F0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0CFFC200110800100010030111"
        "00021101031101FFC4009100010100000000000000000000000000000708010003010000000000000000000000"
        "000001020300100000050501000000000000000000000000010304051031021206151100020104020300000000"
        "000000000000010203001121123104614213120100000000000000000000000000000020130100020203000300"
        "000000000000000001001121314151611071A1FFDA000C03010002110311000001966165CCC3E02B2BFF00FFDA"
        "00080101000105025DFBDDB9CF417969ACB14E539674C4A67FFFDA0008010200010502057057FFDA0008010300"
        "010502A1D3FFDA0008010202063F021FFFDA0008010302063F021FFFDA0008010101063F0273BEB96BC07D736A"
        "E92BCA15134491D1B946362B5D95F88687E9B14E0E738AE9AC2CC049202CAFC8F15FFFDA0008010103013F2117"
        "1453462A85E5EE23212BEE01778BD3A89C00874ED469CCD9ED8A385585B733FFDA0008010203013F2118A096DA"
        "7FFFDA0008010303013F21711D7C1AAC4FFFDA000C030100021103110000104A1FFFDA0008010103013F107A1D"
        "2100142F2D3D97AD69E432A2856D1188F494A6E45966B9749C54BDBF8EB1A391216CCFFFDA0008010203013F10"
        "B25817BD79D4CFEE56385E27FFDA0008010303013F10E88333F7D8A9D6237DDCCFFFD9");

    const vuc_t image_rgb = vuc_from_hex(
        "615E575A554F65605A726B655E5550574C485F54505345425C4A46837A7D7F79794F41385E4E41A49B96C1BDBC"
        "ADA5A25E595359524C3F3832423B353B322D4A413C4D443F4338343E3538564E4B73696063504944302544382C"
        "86837E9998A0605750463D36211811261D18231C1638312B3F3832362F2935323B514B3F594C3B46322B553E38"
        "463523716C669BA0B451443C1F140E1C110B281F1819120C15100A1C17110F0C05120D112D21114536232F201B"
        "44322E4330216B625BBEC1D4352820190C04362C23393029181109130E0813100915120B261C13221505291D11"
        "19120C30272253423A796B68D3D0D720130A1E1108392F2631281F160F07262219110E0719160F4333245C4E41"
        "3B322919140E433A33746761867875DBD1D23D3125241A102F251B2E251C29221A413D34201B151B181149382E"
        "675D535951464D40386B5A52897C73908782DAD1D463594D251B0F2A2217281F16191208221B1318130D1C1711"
        "483A393A3428413A2A56403569514585796994918ACEC9D06B645C2B22192C22182B2115261E110B04000D0900"
        "1D1A153E302720170E26211D443A3962544B776855998C84C8C1C98B7E7641342C382B22291F1533291F2B2219"
        "110801180F0A31231A362A1E382C203B2C25554538695949948A81D3CCD39482785D4C44372A221B100A261D16"
        "3A2F2934292343362E483A31453221442B174F35266653456A5E4E999089D5CBD399857A5F4E44271D141C150F"
        "0E09030A0300251B1265584F82746B69533E66462D6B4C37604A3C594D3F99928CD5CCD19181725D514520190F"
        "1310090C0C040F0C050A060022191066595067523D705037664733503B2A5D5143A39C94D3CACF82746760564A"
        "1E180C1614081010060D0D050B08000C0900190F064939295F4A3750392B4532245F5343988F86D1C8CD7B6F63"
        "685C5020160A1F170C1E170D120E050F0C050A0702130A03271F14261C1223160E2E1E11524330776D63BFB6BB"
        "84766D6F61582D1F14180A00190C031B120B120D0916120F251C1515120B0C0B0717120F1F110640311C685C50"
        "BEB5BA");

    const tuple<ul_t, ul_t, vuc_t> t = decompress_jpeg_insecurely(image_jpeg);

    return t.get<0>() == 16 && t.get<1>() == 16 && t.get<2>() == image_rgb;
}

int main() {
    NUWEN_TEST("jpeg1", test())
}
